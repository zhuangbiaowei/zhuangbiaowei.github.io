<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" /> <!--[if lte IE 9]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]--> <title>experience.exe</title> <meta name="description" content="一个只有程序员才能立刻理解的笑话：「中国的法律是txt格式的，西方的法律是exe格式的。」当然，这个笑话相当片面（废话），但是却可以成一个很好的引子，引出今天的话题：「什么才算是可以被执行的经验？」"> <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600|Droid+Sans+Mono' rel='stylesheet' type='text/css'> <link rel="stylesheet" href="/css/main.css"> <link rel="canonical" href="http://localhost:4040/thinking/it/2015/03/01/experience.exe.html"> <link rel="alternate" type="application/rss+xml" title="读书、思考、生活" href="http://localhost:4040/feed.xml" /> <link rel="icon" type="image/png" href="/assets/icon/favicon-32x32.png" sizes="32x32" /> <link rel="icon" type="image/png" href="/assets/icon/favicon-16x16.png" sizes="16x16" /> <script src="/assets/js/prefixfree.js"></script> </head> <body> <aside id="sidebar"> <div id="sidebar-left"> <a id="sidebar-avatar" href="/"> <img id="sidebar-avatar-img" alt="" src="/assets/img/avatar.jpg"/> </a> <div id="sidebar-social"> <a href="/feed.xml" class="sidebar-social-icon feed"></a> <a href="mailto:zhuangbiaowei@gmail.com" class="sidebar-social-icon email"></a> <a href="http://www.weibo.com/zhuangbiaowei" class="sidebar-social-icon weibo" target="_blank"></a> <a href="https://github.com/zhuangbiaowei" class="sidebar-social-icon github" target="_blank"></a> </div> <ul id="sidebar-tags"> <li class="sidebar-tag active" data-filter="all">全部文章</li> <li class="sidebar-tag" data-filter="OpenSource">OpenSource</li> <li class="sidebar-tag" data-filter="SoftwareEngineer">SoftwareEngineer</li> <li class="sidebar-tag" data-filter="Product">Product</li> <li class="sidebar-tag" data-filter="BookReview">BookReview</li> <li class="sidebar-tag" data-filter="Programming">Programming</li> <li class="sidebar-tag" data-filter="Essay">Essay</li> <li class="sidebar-tag" data-filter="Cloud">Cloud</li> <li class="sidebar-tag" data-filter="FreeSoftware">FreeSoftware</li> <li class="sidebar-tag" data-filter="Community">Community</li> <li class="sidebar-tag" data-filter="Thinking">Thinking</li> <li class="sidebar-tag" data-filter="IT">IT</li> <li class="sidebar-tag" data-filter="Economy">Economy</li> <li class="sidebar-tag" data-filter="psychology">psychology</li> </ul> </div> <div id="sidebar-right"> <div id="select-box"> Years: <select id="select-year"> <option>all</option> <option>2021</option> <option>2020</option> <option>2019</option> <option>2017</option> <option>2016</option> <option>2015</option> <option>2014</option> </select> </div> <nav id="toc"> <a class="toc-link" data-tags="Essay" data-year="2021" href="/complexworld/2021/02/17/about-code-2-0.html"> 围绕Code 2.0的一些随感 </a> <a class="toc-link" data-tags="Essay" data-year="2020" href="/dairy/2020/12/31/Goodbye-2020.html"> 再见 2020 </a> <a class="toc-link" data-tags="Thinking" data-year="2020" href="/reading/2020/12/20/Reading-Notes.html"> 读书札记 </a> <a class="toc-link" data-tags="Essay" data-year="2019" href="/dairy/2019/04/05/about-996.html"> 漫谈996 </a> <a class="toc-link" data-tags="Essay" data-year="2017" href="/dairy/2017/12/31/annual-summary.html"> 2017年度汉字——转 </a> <a class="toc-link" data-tags="Essay" data-year="2017" href="/dairy/2017/12/16/talk-to-jianshu.html"> 我是一个程序员，我想和简书聊聊 </a> <a class="toc-link" data-tags="psychology" data-year="2017" href="/dairy/2017/05/13/scarcity-psychology.html"> 一念轮回，以及稀缺心理 </a> <a class="toc-link" data-tags="Community Economy" data-year="2017" href="/dairy/2017/04/30/knowledge-economy.html"> 聊聊“知识经济” </a> <a class="toc-link" data-tags="Community" data-year="2017" href="/dairy/2017/02/25/about-gitchat.html"> 为啥我现在沉迷于GitChat </a> <a class="toc-link" data-tags="Essay" data-year="2016" href="/reading/2016/12/31/about-reading.html"> 2016--聊聊读书 </a> <a class="toc-link" data-tags="Essay" data-year="2016" href="/reading/2016/10/05/freedom-to-read.html"> 阅读的自由 </a> <a class="toc-link" data-tags="Essay" data-year="2016" href="/reading/2016/07/09/about-reading-books.html"> 读书的意义在哪里？ </a> <a class="toc-link" data-tags="Essay" data-year="2016" href="/thinking/it/2016/05/02/about-baidu.html"> 如果你非要上百度，这里有三条忠告 </a> <a class="toc-link" data-tags="Thinking" data-year="2016" href="/writing/2016/02/22/writing-freedom-2.html"> 写字的自由——内篇 </a> <a class="toc-link" data-tags="OpenSource" data-year="2016" href="/thinking/it/2016/01/17/gens-collaborative-model.html"> 三代开源社区的协作模式 </a> <a class="toc-link" data-tags="Thinking" data-year="2016" href="/writing/2016/01/11/writing-freedom.html"> 写字的自由——外篇 </a> <a class="toc-link" data-tags="Thinking IT" data-year="2016" href="/thinkingit/2016/01/09/kuaibo-tech-thinking.html"> 快播案，一个猝不及防的时代的缩影 </a> <a class="toc-link" data-tags="Essay" data-year="2016" href="/dairy/2016/01/03/40-years-old.html"> 四十不惑——写给2016年的自己 </a> <a class="toc-link" data-tags="Essay" data-year="2015" href="/dairy/2015/12/12/give-up-learning.html"> 你是从什么时候开始放弃学习的？ </a> <a class="toc-link" data-tags="Essay" data-year="2015" href="/dairy/2015/11/30/Talking-about-lifelong-learning.html"> 聊聊终生学习这件事 </a> <a class="toc-link" data-tags="Essay" data-year="2015" href="/thinking/it/2015/10/25/self-cultivation-of-architects.html"> 论架构师的自我修养 </a> <a class="toc-link" data-tags="Community" data-year="2015" href="/dairy/2015/07/05/I-wish-there-was-a-slow-community.html"> 从前慢——我希望有一个「慢社区」 </a> <a class="toc-link" data-tags="OpenSource" data-year="2015" href="/thinking/it/2015/05/28/Open-Source-Project-Analysis-2.html"> 28万个开源项目之番外篇 </a> <a class="toc-link" data-tags="OpenSource" data-year="2015" href="/thinking/it/2015/05/12/Open-Source-Project-Analysis.html"> 从28万个开源项目中，我们能够学到一些什么？ </a> <a class="toc-link" data-tags="OpenSource FreeSoftware" data-year="2015" href="/thinking/it/2015/05/04/Free-Software-vs-Open-Source.html"> Free Software vs. Open Source </a> <a class="toc-link" data-tags="OpenSource" data-year="2015" href="/thinking/it/2015/05/03/How-to-evaluate-a-new-technology.html"> 如何评价一个新技术——以Docker为例 </a> <a class="toc-link" data-tags="Essay" data-year="2015" href="/thinking/it/2015/03/25/a-future-that-is-not-too-gray.html"> 不会太灰暗的未来 </a> <a class="toc-link" data-tags="OpenSource" data-year="2015" href="/thinking/it/2015/03/11/Open-source-attention-economy.html"> 开源项目也要讲注意力经济 </a> <a class="toc-link" data-tags="Cloud" data-year="2015" href="/thinking/it/2015/03/01/experience.exe.html"> experience.exe </a> <a class="toc-link" data-tags="OpenSource" data-year="2015" href="/thinking/it/2015/02/08/about-openssl.html"> OpenSSL是否值得同情？ </a> <a class="toc-link" data-tags="Essay" data-year="2014" href="/dairy/2014/12/31/my-2014.html"> 转、进、定——我的2014 </a> <a class="toc-link" data-tags="Essay" data-year="2014" href="/dairy/2014/08/18/Dont-be-afraid-to-be-a-fool.html"> 不要害怕做一个傻瓜 </a> <a class="toc-link" data-tags="OpenSource" data-year="2014" href="/thinking/it/2014/06/11/What-can-I-do-for-open-source.html"> 我能为开源做些什么？ </a> <a class="toc-link" data-tags="SoftwareEngineer" data-year="2014" href="/thinking/it/2014/06/11/GUI-2-ways.html"> 图形用户界面(GUI)应用开发的两种思路 </a> <a class="toc-link" data-tags="SoftwareEngineer" data-year="2014" href="/thinking/it/2014/06/10/Definition-of-Software-Development.html"> 定论——软件开发的方法论探讨 </a> <a class="toc-link" data-tags="Product" data-year="2014" href="/thinking/it/2014/06/09/fans-and-requirements.html"> 我是凉粉|《机器人历险记》|Web 2.0 </a> <a class="toc-link" data-tags="Programming" data-year="2014" href="/thinking/it/2014/06/09/An-unforgivable-bug.html"> 一个不可原谅的bug </a> <a class="toc-link" data-tags="SoftwareEngineer" data-year="2014" href="/thinking/it/2014/06/09/CI-for-document.html"> 软件开发文档的持续集成 </a> <a class="toc-link" data-tags="Product" data-year="2014" href="/thinking/it/2014/06/08/ajax-ide.html"> 理想中的Ajax IDE </a> <a class="toc-link" data-tags="BookReview" data-year="2014" href="/thinking/it/2014/06/08/code-complete.html"> 《代码大全》——软件开发的世界地图 </a> <a class="toc-link" data-tags="Product" data-year="2014" href="/thinking/it/2014/06/06/online-2.0.html"> ONLINE 2.0，这是一场硬仗！ </a> <a class="toc-link" data-tags="Product" data-year="2014" href="/thinking/it/2014/06/06/Bloglines-del.icio.us.html"> Bloglines+del.icio.us </a> <a class="toc-link" data-tags="" data-year="2014" href="/thinking/it/2014/06/06/knowledge-management.html"> 小型企业知识管理的好办法——Google四件宝 </a> <a class="toc-link" data-tags="" data-year="2014" href="/thinking/it/2014/06/04/Next-Generation-Search-Engine.html"> 下一代搜索技术的四块积木 </a> <a class="toc-link" data-tags="SoftwareEngineer" data-year="2014" href="/thinking/it/2014/05/31/Tags_and_CMM.html"> 思考tags与主题词、敏捷与CMM、草根与精英 </a> <a class="toc-link" data-tags="SoftwareEngineer" data-year="2014" href="/thinking/it/2014/05/13/Agile-and-others.html"> 聊我所理解的敏捷(Agile)——外一篇 </a> <a class="toc-link" data-tags="" data-year="2014" href="/thinking/it/2014/04/27/power-of-architecture.html"> 架构的力量 </a> <a class="toc-link" data-tags="OpenSource" data-year="2014" href="/thinking/it/2014/04/26/iMIS.html"> iMIS为什么会失败？ </a> <a class="toc-link" data-tags="OpenSource" data-year="2014" href="/thinking/it/2014/04/26/Java-To-Rails.html"> Java社群该向Ruby on Rails学习些什么？ </a> <a class="toc-link" data-tags="OpenSource" data-year="2014" href="/thinking/it/2014/04/24/dreaming-in-code.html"> 外国大牛也不过如此——《梦断代码》读后感 </a> <a class="toc-link" data-tags="" data-year="2014" href="/thinking/it/2014/04/23/SNS-IM-BBS-JavaEye.html"> SNS、IM、BBS与JavaEye </a> </nav> </div> </aside> <main id="main"> <article class="post container"> <div class="post-meta"> <span class="post-meta-span date">2015 March 01</span> <span class="post-meta-span tag">Cloud</span> </div> <h1 class="post-title">experience.exe</h1> <p>一个只有程序员才能立刻理解的笑话：「中国的法律是txt格式的，西方的法律是exe格式的。」当然，这个笑话相当片面（废话），但是却可以成一个很好的引子，引出今天的话题：「什么才算是可以被执行的经验？」</p> <h2 id="一先来谈谈什么样的经验是txt格式的">一、先来谈谈，什么样的经验是txt格式的</h2> <p>在stackoverflow，有大量的问题，是这种格式：「在XX平台上，我想跑XX和XX和XX，怎么搞？」、或者「我在安装/运行XX的时候，系统报错，说是找不到XX，怎么办？」</p> <p>这些问题，通常有其他老手已经碰到过了。于是，有某个好心人，在下面答复一番，读到这段说明的新手，再照此操作一番。</p> <p>如果顺利的话，自然就OK了。如果搞出其他的问题，只怕还要再来追加提问。</p> <h2 id="二再来谈谈什么样的经验是可执行的">二、再来谈谈，什么样的经验是可执行的</h2> <p>所有的开源项目，都包含了宝贵的经验，而且一旦编译(动态语言只需要配置一下)成功，就是可执行的了。</p> <p>当然，编译与配置，同样需要经验。configure脚本与Makefile、Rake脚本，就是这种编译类经验的可执行版本。而Gemfile、requirement.txt、package.json之类的文件则是配置类经验的可执行版本。</p> <p>这些当然都是极好的，但是却又远远不够。我们依然需要阅读install文档，依然有各种坑需要去踩。</p> <h2 id="三曾经的一个设想dependencyio">三、曾经的一个设想：dependency.io</h2> <p>大概在去年6~7月份的时候，我曾经有过一个设想，主要也是受到了brew的启发：如果有某种机制，能够解决任意平台、任意语言、任意情况下的各种依赖问题，那应该可以大大的解放开发者吧。如果每个人都能够将自己的一点经验分享出来，再汇集到一起，世界一定会变得更加美好吧。</p> <p>但是，在略微思考之后，就发现要解决这个问题，实在是太复杂了。</p> <ul> <li>一个系统要正常运行，考虑到不同的操作系统、平台与版本，需要正确的配置一堆组件</li> <li>一个组件需要考虑其版本、依赖平台以及获取方式，还有它所要依赖的其他组件</li> <li>最简单的办法自然是apt-get，但是有时候必须考虑从源代码编译，甚至在特定平台版本之下，需要打上某些patch，才能正确编译</li> <li>也许在某个平台下，就是无法编译、安装成功的，这个在知识库里也应该有「结论」</li> <li>在一切都已经在我的机器上安装完成之后，还需要正确的配置，将他们组合起来</li> <li>如果在我的机器里，需要并存一个组件的几个不同版本，如何避开冲突，也是一场噩梦</li> <li>以上的这一切，需要一个层层递进的依赖关系，以及一个足够灵活的数据格式</li> </ul> <p>最后，我放弃了这个项目！当然，类似的事情，还有人一直在做：<a href="https://supermarket.chef.io/cookbooks-directory">Chef &amp; Cookbook</a></p> <h2 id="四重型的解决方案">四、重型的解决方案</h2> <p>在我们的项目组里，有一个非常笨重，但却有效的办法：派一位「死士」先在一台干净的虚拟机上，把所有的依赖问题解决，完成各种配置，最后将虚拟机复制N份，给每个开发人员使用。</p> <p>多年以前的vagrant+box+virtualbox，其实就是这样一种方案的略微方便一些的版本。</p> <p>为什么说这样的方案是「重型」的？虚拟机的大小是几百M；启动时间至少几十秒；一台虚拟机至少占用几百M甚至几个G的内存；当然还有高昂的CPU计算资源消耗；如果这一切都仅仅是为了解决复杂的依赖关系，那也太奢侈了。</p> <h2 id="五容器一个足够好的折中方案">五、容器——一个足够好的折中方案</h2> <p>基于容器，我们可以获得一个个基本上近似于干净、相互隔离的「操作系统」，在此基础上的配置与依赖关系，可以通过足够简单的方式来描述。</p> <p>而另一方面，由于容器的大小、启动时间、占用内存、消耗CPU都大大的低于基于虚拟机的重型方案，这就使得在一台机器上，同时启动成百上千个容器实例，也不在话下。</p> <p>这种优势对于运维的好处先按下不表，这里先讨论其对于经验梳理的意义：原本在一台虚拟机里，我们需要配置N个不同的组件，以及组件之间的相关配置，要将其组成在一起，使其能够顺利工作，复杂度是惊人的。现在，我们可以将工作分为两部分：每个组件的依赖描述，以及组件之间的组合配置关系。</p> <p>举一个简单的例子：<a href="https://github.com/atomic-penguin/cookbook-gitlab">cookbook gitlab</a> 与 <a href="https://github.com/sameersbn/docker-gitlab">docker gitlab</a></p> <p>这两个项目，就是两种不同思路与技术平台的产物，同样是为了描述「安装并运行Gitlab」的经验，复杂度大概会相差10倍。在docker模式下，我们只需要阅读Dockerfile与fig.yml两个文件，大约50+行，就能够搞明白了。而在Chef模式下，我们至少得阅读recipes目录下的三个文件，大约500+行吧……</p> <p>另外一件docker做得特别靠谱的事情，是建立了简单好用的<a href="https://registry.hub.docker.com/">Docker Hub</a>，这使得创建、分享、学习各种经验，变得更加容易了。</p> <h3 id="题外话">题外话</h3> <p>另外一个值得关注的社区，是<a href="http://wercker.com/">wercker</a>，这个社区也在以<a href="https://app.wercker.com/#explore/boxes">boxes</a>与<a href="https://app.wercker.com/#explore/steps">steps</a>的方式，在努力构造更加容易分享和执行的经验。</p> <h2 id="六从经验描述的角度来看dockerfile与figyml">六、从经验描述的角度来看dockerfile与fig.yml</h2> <p>如果扯远一点的话，我们可以看到几种不同的描述经验的格式，广义的来看，无非是某种DSL而已。</p> <ul> <li>顺序执行式：当我需要做一些事情，按照顺序1，2，3这样做下去。</li> <li>加上IF/ELSE/FOR/WHILE的顺序执行式：在顺序执行的基础上，做一些条件与分支判断，通过循环在减少一些重复代码，然后就差不多了。</li> <li>Makefile/Rake风格：一件事情，可以分解为多个task，每个task可能存在前置依赖的task，整个任务可以被分解为层层依赖的一堆task。</li> <li>Config/YAML/XML风格：这是较为死板的一种模式，甚至几乎称不上是描述经验的DSL，而是将各种配置参数，以较为方便阅读的格式写出来而已。</li> </ul> <p>目前的Dockerfile，与fig.yml（升级为docker compose之后，变成docker-compose.yml了），可以说都相当简陋。缺乏许多重要的特性。目前只能算是堪堪够用，却远不能称之为好用。</p> <ul> <li>docker build无法带参数，一个Dockerfile只能build出一个结果。假设两个非常接近的image，我也只能写两Dockerfile；</li> <li>docker compose同样无法带参数，我不能使用同一个yml配置文件，或者启动developement模式、或者启动production模式；</li> <li>构造容器与组件的很多经验，实际上需要写在这两个文件之外，以某种魔法的形式，在不知不觉中被引入容器；</li> </ul> <h2 id="七针对未来的一些猜想">七、针对未来的一些猜想</h2> <ul> <li>在dockerfile与fig.yml复杂起来之后，新一轮的DRY式改良，应该会再次出现，函数、参数、模板、include之类的语法也可能会被引入。</li> <li>如果我们将dockerfile看做是一个用来build docker镜像的底层脚本，说不定可以创造某种更加高级的DSL，用来编译生成出最终的Dockerfile。</li> <li>如果将来容器大行其道，可以被执行的经验越来越多，分享与交流经验的社区越做yue好，只怕stackoverflow，会渐渐的衰落吧。</li> </ul> </article> <div class="post-share"> <div class="container"> <a href="https://twitter.com/share?url=http://localhost:4040/thinking/it/2015/03/01/experience.exe.html&text=experience.exe" target="_blank" class="post-share-icon twitter"></a> <a href="https://www.evernote.com/clip.action?url=http://localhost:4040/thinking/it/2015/03/01/experience.exe.html&title=experience.exe" target="_blank" class="post-share-icon evernote"></a> <a href="http://service.weibo.com/share/share.php?url=http://localhost:4040/thinking/it/2015/03/01/experience.exe.html&title=experience.exe" target="_blank" class="post-share-icon weibo"></a> </div> </div> <div class="footer"> <div class="container"> <p class="footer-entry">All content is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA</a></p> <p class="footer-entry">Buit with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll theme</a> • Hosted on <a href="https://pages.github.com/" target="_blank">Github</a></p> </div> </div> </main> <button id="menu"> <span id="menu-icons"></span> </button> <script src="/assets/js/jquery-2.1.3.min.js"></script> <script src="/assets/js/jquery.pjax.js"></script> <script src="/assets/js/nprogress.js"></script> <script src="/assets/js/main.js"></script> </body> </html>
